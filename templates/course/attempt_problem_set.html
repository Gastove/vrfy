{% extends 'course/base.html' %}
{% load staticfiles %}
{% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script>
numFiles=0

$(document).ready(function(){
  $("[name=add]").click(function(){
    if(numFiles < {{ max_additional_files }}) {
      input='<div class="form-group"><label class="col-sm-2" for="additional">Additonal File</label><input class="col-sm-3" name="additional"type="file"></div>';
      $(input).insertBefore($(this).parent().parent());
      numFiles++;
    }
  });
});

</script>
<section class="problem-set">
<section class="ps-info page-header">
<p class="h1">{{ problem_set.title }} </p>
<p class="h2" style="margin-top:0;"><small><span class="glyphicon glyphicon-time"></span> Due {{ problem_set.due_date }}</small></p>
<p class="lead">{{problem_set.description}}</p>
</section>

{% for problem, solution in problem_set_dict.items %}
{% if solution.submitted %}
  {% if not problem.many_attempts %}
    <section id="problem-{{problem.id}}" class="panel panel-default">
      <div class="panel-heading">
        <h3><span class=text-muted>
            <span class="glyphicon glyphicon-ban-circle"></span> Cannot re-attempt {{ problem.title }}</span></h3>
      </div>
    </section>
  {% else %}
    <section id="problem-{{problem.id}}" class="panel panel-default">
      <div class="panel-heading">
        <h3><span role="button" data-toggle="collapse" data-parent="#problem-{{problem.id}}" href="#collapse-problem-{{problem.id}}" aria-expanded="true" aria-controls="collapseOne">
            <span class="glyphicon glyphicon-repeat"></span> Re-attempt {{ problem.title }} <small>(Attempt No. {{solution.attempt_num|add:'1'}})</small></span></h3>
      </div>
      <div id="collapse-problem-{{problem.id}}" class="panel-body panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
        <p>{{ problem.description }}</p>
        <p>{{ problem.statement }}</p>
        <hr>
        <section class="problem-form">
          <form id="soln_form" class="form-horizontal" action="{% url 'course:problem_submit' problem_set.id  problem.id %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <p class="help-block">Upload the required files for {{problem.title}}</p>
            {% for file in problem.requiredproblemfilename_set.all %}
              <div class="form-group">
                <label class="col-sm-2" for="{{ file.file_title }}">{{ file.file_title }}</label>
                <input class="col-sm-3" type="file" name="{{ file.file_title }}" id="{{ file.file_title }}">
                {% if file.force_rename %}
                  <span class="col-sm-5 text-warning">WARNING: this file will be renamed to {{ file.file_title }}.</span>
                {% endif %}
              </div>
            {% endfor %}
            <div class="form-group">
              <div class="col-sm-2">
                <button name="add" type="button" class="btn btn-default btn-sm">
                  <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                </button>
              </div>
            </div>
            <button type="submit" class="btn btn-default" id="submit">Submit {{problem.title}}</button>
          </form>
        </section>
      </div>
    </section>
  {% endif %}
{% else %}
  <section id="problem-{{problem.id}}" class="panel panel-default">
    <div class="panel-heading">
      <h3><span role="button" data-toggle="collapse" data-parent="#problem-{{problem.id}}" href="#collapse-problem-{{problem.id}}" aria-expanded="true" aria-controls="collapseOne">
          Attempt {{ problem.title }}</span></h3>
    </div>
    <div id="collapse-problem-{{problem.id}}" class="panel-body panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <p>{{ problem.description }}</p>
      <p>{{ problem.statement }}</p>
      <hr>
      <section class="problem-form">
        <form class="form-horizontal" action="{% url 'course:problem_submit' problem_set.id  problem.id %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <p class="help-block">Upload the required files for {{problem.title}}</p>
          {% for file in problem.requiredproblemfilename_set.all %}
            <div class="form-group">
              <label class="col-sm-2" for="{{ file.file_title }}">{{ file.file_title }}</label>
              <input class="col-sm-8" type="file" name="{{ file.file_title }}" id="{{ file.file_title }}">
            </div>
          {% endfor %}
          <button type="submit" class="btn btn-default">Submit {{problem.title}}</button>
          {% if not problem.many_attempts %}
            <span class=text-danger>WARNING: You can only submit this problem once!</span>
          {% endif %}
        </form>
      </section>
    </div>
  </section>
{% endif %}
{% endfor %}
{% endblock content %}

{% block otherscripts %}
<script src="{% static 'course/js/app.min.js' %}"></script>
{% endblock %}
